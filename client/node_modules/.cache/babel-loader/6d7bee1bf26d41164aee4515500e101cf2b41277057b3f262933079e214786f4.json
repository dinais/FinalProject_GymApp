{"ast":null,"code":"// פונקציה לקרוא קוקיז לפי שם\nfunction getCookie(name) {\n  const value = `; ${document.cookie}`;\n  const parts = value.split(`; ${name}=`);\n  if (parts.length === 2) return parts.pop().split(';').shift();\n  return null;\n}\n\n// פונקציה להוריד קוקיז לפי שם\nfunction removeCookie(name) {\n  document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; Secure; HttpOnly`;\n}\n\n// שמירת refreshToken בקוקיז\nfunction setRefreshTokenInCookies(refreshToken) {\n  const expires = new Date();\n  expires.setFullYear(expires.getFullYear() + 1); // שמירה לשנה\n  document.cookie = `refreshToken=${refreshToken}; expires=${expires.toUTCString()}; path=/; Secure`; // הסר HttpOnly\n}\n\n// פונקציה לרענן את הטוקן במקרה של שגיאה 401 או 403\nasync function refreshTokenIfNeeded(response) {\n  if (response.status !== 401 && response.status !== 403) return null;\n  const refreshToken = getCookie('refreshToken'); // קריאה מהקוקיז\n  if (!refreshToken) return null;\n  const res = await fetch('http://localhost:3001/refresh-token', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({\n      token: refreshToken\n    }),\n    credentials: 'include' // כלול את הקוקיז בבקשה\n  });\n  if (!res.ok) {\n    localStorage.removeItem('token');\n    removeCookie('refreshToken'); // מחיקת הקוקיז אם לא הצלחנו לרענן\n    return null;\n  }\n  const data = await res.json();\n  localStorage.setItem('token', data.accessToken);\n  return data.accessToken;\n}\n\n// פונקציה לשלוח בקשה עם רענון טוקן במקרה של שגיאה\nasync function sendRequestWithRefresh(method, url, body = null) {\n  const makeFetch = async token => {\n    return fetch(`http://localhost:3001/${url}`, {\n      method,\n      headers: {\n        'Content-Type': 'application/json',\n        ...(token && {\n          'Authorization': `Bearer ${token}`\n        })\n      },\n      credentials: 'include',\n      // כלול את הקוקיז בבקשה\n      ...(body ? {\n        body: JSON.stringify(body)\n      } : {})\n    });\n  };\n  const token = localStorage.getItem('token');\n  let response = await makeFetch(token);\n  if (!response.ok) {\n    const newToken = await refreshTokenIfNeeded(response);\n    if (newToken) {\n      response = await makeFetch(newToken);\n    }\n  }\n  const result = {\n    succeeded: response.ok,\n    error: '',\n    data: null\n  };\n  if (response.ok) {\n    try {\n      result.data = await response.json();\n    } catch {\n      result.data = null;\n    }\n  } else {\n    result.error = 'משהו השתבש. נסה שוב.';\n  }\n  return result;\n}\n\n// פונקציות לשליחת בקשות GET, POST, PUT, PATCH, DELETE\nexport async function getRequest(url) {\n  return await sendRequestWithRefresh('GET', url);\n}\nexport async function postRequest(url, body) {\n  return await sendRequestWithRefresh('POST', url, body);\n}\nexport async function putRequest(url, body) {\n  return await sendRequestWithRefresh('PUT', url, body);\n}\nexport async function patchRequest(url, body) {\n  return await sendRequestWithRefresh('PATCH', url, body);\n}\nexport async function deleteRequest(url) {\n  return await sendRequestWithRefresh('DELETE', url);\n}\nexport { setRefreshTokenInCookies };","map":{"version":3,"names":["getCookie","name","value","document","cookie","parts","split","length","pop","shift","removeCookie","setRefreshTokenInCookies","refreshToken","expires","Date","setFullYear","getFullYear","toUTCString","refreshTokenIfNeeded","response","status","res","fetch","method","headers","body","JSON","stringify","token","credentials","ok","localStorage","removeItem","data","json","setItem","accessToken","sendRequestWithRefresh","url","makeFetch","getItem","newToken","result","succeeded","error","getRequest","postRequest","putRequest","patchRequest","deleteRequest"],"sources":["C:/Users/לאה הדס/Desktop/מדעי המחשב/שנה ב/web/FinalProject_GymApp/client/src/Requests.js"],"sourcesContent":["\r\n// פונקציה לקרוא קוקיז לפי שם\r\nfunction getCookie(name) {\r\n    const value = `; ${document.cookie}`;\r\n    const parts = value.split(`; ${name}=`);\r\n    if (parts.length === 2) return parts.pop().split(';').shift();\r\n    return null;\r\n}\r\n\r\n// פונקציה להוריד קוקיז לפי שם\r\nfunction removeCookie(name) {\r\n    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; Secure; HttpOnly`;\r\n}\r\n\r\n// שמירת refreshToken בקוקיז\r\nfunction setRefreshTokenInCookies(refreshToken) {\r\n    const expires = new Date();\r\n    expires.setFullYear(expires.getFullYear() + 1); // שמירה לשנה\r\n    document.cookie = `refreshToken=${refreshToken}; expires=${expires.toUTCString()}; path=/; Secure`; // הסר HttpOnly\r\n\r\n}\r\n\r\n// פונקציה לרענן את הטוקן במקרה של שגיאה 401 או 403\r\nasync function refreshTokenIfNeeded(response) {\r\n    if (response.status !== 401 && response.status !== 403) return null;\r\n\r\n    const refreshToken = getCookie('refreshToken'); // קריאה מהקוקיז\r\n    if (!refreshToken) return null;\r\n\r\n    const res = await fetch('http://localhost:3001/refresh-token', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ token: refreshToken }),\r\n        credentials: 'include', // כלול את הקוקיז בבקשה\r\n    });\r\n\r\n    if (!res.ok) {\r\n        localStorage.removeItem('token');\r\n        removeCookie('refreshToken'); // מחיקת הקוקיז אם לא הצלחנו לרענן\r\n        return null;\r\n    }\r\n\r\n    const data = await res.json();\r\n    localStorage.setItem('token', data.accessToken);\r\n    return data.accessToken;\r\n}\r\n\r\n// פונקציה לשלוח בקשה עם רענון טוקן במקרה של שגיאה\r\nasync function sendRequestWithRefresh(method, url, body = null) {\r\n    const makeFetch = async (token) => {\r\n        return fetch(`http://localhost:3001/${url}`, {\r\n            method,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                ...(token && { 'Authorization': `Bearer ${token}` }),\r\n            },\r\n            credentials: 'include', // כלול את הקוקיז בבקשה\r\n            ...(body ? { body: JSON.stringify(body) } : {}),\r\n        });\r\n    };\r\n\r\n    const token = localStorage.getItem('token');\r\n    let response = await makeFetch(token);\r\n\r\n    if (!response.ok) {\r\n        const newToken = await refreshTokenIfNeeded(response);\r\n        if (newToken) {\r\n            response = await makeFetch(newToken);\r\n        }\r\n    }\r\n\r\n    const result = {\r\n        succeeded: response.ok,\r\n        error: '',\r\n        data: null,\r\n    };\r\n\r\n    if (response.ok) {\r\n        try {\r\n            result.data = await response.json();\r\n        } catch {\r\n            result.data = null;\r\n        }\r\n    } else {\r\n        result.error = 'משהו השתבש. נסה שוב.';\r\n    }\r\n\r\n    return result;\r\n}\r\n\r\n// פונקציות לשליחת בקשות GET, POST, PUT, PATCH, DELETE\r\nexport async function getRequest(url) {\r\n    return await sendRequestWithRefresh('GET', url);\r\n}\r\n\r\nexport async function postRequest(url, body) {\r\n    return await sendRequestWithRefresh('POST', url, body);\r\n}\r\n\r\nexport async function putRequest(url, body) {\r\n    return await sendRequestWithRefresh('PUT', url, body);\r\n}\r\n\r\nexport async function patchRequest(url, body) {\r\n    return await sendRequestWithRefresh('PATCH', url, body);\r\n}\r\n\r\nexport async function deleteRequest(url) {\r\n    return await sendRequestWithRefresh('DELETE', url);\r\n}\r\nexport { setRefreshTokenInCookies };\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}